services:
  rules-lawyer-models:
    build:
      context: .
      dockerfile: docker/Dockerfile
      args:
        UNSLOTH_INSTALLER_REF: "main"
    image: rules-lawyer-models:cu128-py31114
    working_dir: /workspace
    volumes:
      - ./:/workspace
      - ${HOME}/.cache/uv:/home/dev/.cache/uv
      - ${HOME}/.cache/pip:/home/dev/.cache/pip
      - ${HOME}/.cache/huggingface:/home/dev/.cache/huggingface
      - ${HOME}/.cache/unsloth_compiled_cache:/workspace/unsloth_compiled_cache
    environment:
      - HF_HOME=/home/dev/.cache/huggingface
      - UV_PROJECT_ENVIRONMENT=/opt/venv
    shm_size: "8gb"
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: [ gpu ]
    command: [ "sleep", "infinity" ]
    tty: true
    stdin_open: true
